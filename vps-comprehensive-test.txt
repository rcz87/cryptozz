#!/bin/bash
echo "üîç VPS COMPREHENSIVE ENDPOINT TEST"
echo "==================================="
echo ""

BASE_URL="http://localhost:5050"

echo "1. CORE PLATFORM ENDPOINTS:"
echo "============================="

echo "Testing Main Platform:"
curl -s "$BASE_URL/" | head -3
echo ""

echo "Testing Health Check:"
curl -s "$BASE_URL/health" 
echo ""

echo "Testing GPTs Status:"
curl -s "$BASE_URL/api/gpts/status"
echo ""

echo "2. TRADING SIGNAL ENDPOINTS:"
echo "============================="

echo "Testing Sharp Signal (Default):"
curl -s "$BASE_URL/api/gpts/sinyal/tajam" | head -3
echo ""

echo "Testing Sharp Signal (JSON format):"
curl -s "$BASE_URL/api/gpts/sinyal/tajam?symbol=BTCUSDT&timeframe=1H&format=json" | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    print(f'‚úÖ JSON Format: {data.get(\"format\", \"N/A\")}')
    print(f'Signal: {data.get(\"signal\", {}).get(\"action\", \"N/A\")}')
    print(f'Confidence: {data.get(\"signal\", {}).get(\"confidence\", \"N/A\")}')
except Exception as e:
    print(f'‚ùå Error: {e}')
"
echo ""

echo "Testing Sharp Signal (Narrative format):"
curl -s "$BASE_URL/api/gpts/sinyal/tajam?symbol=BTCUSDT&timeframe=1H&format=narrative" | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    print(f'‚úÖ Narrative Format: {data.get(\"format\", \"N/A\")}')
    if 'narrative' in data:
        print(f'Narrative Length: {len(data[\"narrative\"])} chars')
    if 'human_readable' in data:
        print(f'Human Readable Length: {len(data[\"human_readable\"])} chars')
    if 'telegram_message' in data:
        print(f'Telegram Message Length: {len(data[\"telegram_message\"])} chars')
except Exception as e:
    print(f'‚ùå Error: {e}')
"
echo ""

echo "Testing Sharp Signal (Both format):"
curl -s "$BASE_URL/api/gpts/sinyal/tajam?symbol=BTCUSDT&timeframe=1H&format=both" | head -5
echo ""

echo "3. PERFORMANCE & AI ENDPOINTS:"
echo "==============================="

echo "Testing Performance Stats:"
curl -s "$BASE_URL/api/performance/stats" | python3 -c "
import json, sys
try:
    data = json.load(sys.stdin)
    print(f'‚úÖ Status: {data.get(\"status\", \"N/A\")}')
    print(f'Total Trades: {data.get(\"data\", {}).get(\"trade_statistics\", {}).get(\"total_trades\", \"N/A\")}')
    print(f'Win Rate: {data.get(\"data\", {}).get(\"overview\", {}).get(\"win_rate\", \"N/A\")}')
except Exception as e:
    print(f'‚ùå Error: {e}')
"
echo ""

echo "Testing Performance Metrics:"
curl -s "$BASE_URL/api/performance/metrics" | head -3
echo ""

echo "4. STATEFUL AI ENDPOINTS:"
echo "=========================="

echo "Testing Signal History:"
curl -s "$BASE_URL/api/state/signal-history" | head -3
echo ""

echo "Testing GPT Query Logs:"
curl -s "$BASE_URL/api/state/gpt-queries" | head -3
echo ""

echo "5. CRYPTO NEWS ENDPOINTS:"
echo "=========================="

echo "Testing News Analysis:"
curl -s "$BASE_URL/api/crypto-news/analyze" | head -3
echo ""

echo "Testing News Sentiment:"
curl -s "$BASE_URL/api/crypto-news/sentiment" | head -3
echo ""

echo "6. ML PREDICTION ENDPOINTS:"
echo "============================"

echo "Testing AI Prediction:"
curl -s "$BASE_URL/api/ai/prediction?symbol=BTCUSDT" | head -3
echo ""

echo "Testing ML Analysis:"
curl -s "$BASE_URL/api/ml/analysis" | head -3
echo ""

echo "7. ENHANCED OKX ENDPOINTS:"
echo "==========================="

echo "Testing Funding Rates:"
curl -s "$BASE_URL/api/okx/funding-rates" | head -3
echo ""

echo "Testing Long/Short Ratio:"
curl -s "$BASE_URL/api/okx/long-short-ratio" | head -3
echo ""

echo "8. SECURITY ENDPOINTS:"
echo "======================="

echo "Testing Prompt Validation:"
curl -s "$BASE_URL/api/security/validate-prompt" | head -3
echo ""

echo "Testing System Health:"
curl -s "$BASE_URL/api/monitoring/system-health" | head -3
echo ""

echo ""
echo "==================================="
echo "‚úÖ VPS COMPREHENSIVE TEST COMPLETED"
echo "==================================="